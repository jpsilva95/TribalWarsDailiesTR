(function(){var _0x1a2b='use strict';var _0x3c4d=function(){var _0x5e6f=document.querySelector('.questlog, #questlog_new, [id*="questlog"]');if(_0x5e6f){var _0x7g8h=document.createElement('div');_0x7g8h.style.cssText='margin-top: 5px; text-align: center;';var _0x9i0j=document.createElement('button');_0x9i0j.innerHTML='<img src="https://i.ibb.co/RptK4TP5/teamrocketlogo.gif" style="width: 30px; height: 30px;">';_0x9i0j.title='Daily Stats to Discord';_0x9i0j.style.cssText='width: 40px; height: 40px; background: transparent; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; padding: 0;';_0x9i0j.onclick=function(_0x1k2l){_0x1k2l.preventDefault();_0x3m4n();};_0x7g8h.appendChild(_0x9i0j);_0x5e6f.appendChild(_0x7g8h);}else{var _0x5o6p=document.querySelector('#header_info');if(_0x5o6p){var _0x7q8r=document.createElement('a');_0x7q8r.href='#';_0x7q8r.innerHTML='<img src="https://i.ibb.co/RptK4TP5/teamrocketlogo.gif" style="width: 20px; height: 20px; vertical-align: middle;">';_0x7q8r.title='Daily Stats';_0x7q8r.style.cssText='margin-left: 10px; padding: 5px; background: transparent; border: none; text-decoration: none; display: inline-block;';_0x7q8r.onclick=function(_0x9s0t){_0x9s0t.preventDefault();_0x3m4n();};_0x5o6p.appendChild(_0x7q8r);}}};var _0x3m4n=function(){var _0x1u2v=document.createElement('div');_0x1u2v.style.cssText='position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;';var _0x3w4x=document.createElement('div');_0x3w4x.style.cssText='background: #2C2F33; color: #DCDDDE; padding: 25px; border-radius: 8px; width: 550px; box-shadow: 0 8px 16px rgba(0,0,0,0.3);';_0x3w4x.innerHTML='<h2 style="margin-top: 0; color: #5865F2;">üìä Send Daily Stats to Discord</h2><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Discord Webhook URL:</label><input type="text" id="webhookUrl" placeholder="https://discord.com/api/webhooks/..." style="width: 100%; padding: 8px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box;"></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px;"><input type="checkbox" id="autoSendEnabled" style="margin-right: 5px;"><strong>Auto-send daily at:</strong></label><input type="time" id="autoSendTime" value="23:00" disabled style="width: 100%; padding: 8px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box;"><p style="font-size: 12px; color: #B9BBBE; margin: 5px 0 0 0;">Leave the game open for auto-send to work</p></div><div id="statsPreview" style="background: #40444B; padding: 15px; border-radius: 4px; margin-bottom: 15px;"><p style="margin: 5px 0;"><strong>Gathering stats...</strong></p></div><div style="display: flex; gap: 10px;"><button id="sendBtn" style="flex: 1; padding: 10px; background: #5865F2; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">Send to Discord</button><button id="closeBtn" style="flex: 1; padding: 10px; background: #ED4245; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">Close</button></div><div id="statusMsg" style="margin-top: 15px; text-align: center; font-size: 14px;"></div>';_0x1u2v.appendChild(_0x3w4x);document.body.appendChild(_0x1u2v);var _0x5y6z=localStorage.getItem('tw_discord_webhook');var _0x7a8b=localStorage.getItem('tw_auto_send_enabled')==='true';var _0x9c0d=localStorage.getItem('tw_auto_send_time')||'23:00';if(_0x5y6z){document.getElementById('webhookUrl').value=_0x5y6z;}var _0x1e2f=document.getElementById('autoSendEnabled');var _0x3g4h=document.getElementById('autoSendTime');_0x1e2f.checked=_0x7a8b;_0x3g4h.value=_0x9c0d;_0x3g4h.disabled=!_0x7a8b;_0x1e2f.onchange=function(){_0x3g4h.disabled=!_0x1e2f.checked;localStorage.setItem('tw_auto_send_enabled',_0x1e2f.checked);if(_0x1e2f.checked){localStorage.setItem('tw_auto_send_time',_0x3g4h.value);_0x5i6j();}};_0x3g4h.onchange=function(){localStorage.setItem('tw_auto_send_time',_0x3g4h.value);if(_0x1e2f.checked){_0x5i6j();}};var _0x7k8l=document.getElementById('statsPreview');_0x7k8l.innerHTML='<p style="margin: 5px 0;"><strong>Loading stats...</strong></p>';_0x9m0n().then(function(_0x1o2p){var _0x3q4r='';if(Object.keys(_0x1o2p.troops).length>0){_0x3q4r='<p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>‚öîÔ∏è Total Troops at Home:</strong></p>';for(var _0x5s6t in _0x1o2p.troops){var _0x7u8v=_0x1o2p.troops[_0x5s6t];var _0x9w0x=_0x7u8v.icon?'<img src="'+_0x7u8v.icon+'" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 4px;">':'';_0x3q4r+='<p style="margin: 2px 0; padding-left: 20px; font-size: 13px;">'+_0x9w0x+_0x5s6t+': '+_0x7u8v.count+'</p>';}}_0x7k8l.innerHTML='<p style="margin: 5px 0;"><strong>üë§ Player:</strong> '+_0x1o2p.playerName+'</p><p style="margin: 5px 0;"><strong>üåæ Daily Farm Total:</strong> '+_0x1o2p.farmTotal+'</p><p style="margin: 5px 0;"><strong>üì¶ Daily Resources Total:</strong> '+_0x1o2p.gatherTotal+'</p><p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>üí∞ Grand Total:</strong> '+_0x1o2p.grandTotal+'</p>'+_0x3q4r;}).catch(function(_0x1y2z){_0x7k8l.innerHTML='<p style="margin: 5px 0; color: #ED4245;"><strong>Error loading stats. Please try again.</strong></p>';console.error('Error gathering stats:',_0x1y2z);});document.getElementById('closeBtn').onclick=function(){document.body.removeChild(_0x1u2v);};document.getElementById('sendBtn').onclick=async function(){var _0x3a4b=document.getElementById('webhookUrl').value.trim();var _0x5c6d=document.getElementById('statusMsg');if(!_0x3a4b){_0x5c6d.innerHTML='<span style="color: #ED4245;">‚ùå Please enter a webhook URL</span>';return;}localStorage.setItem('tw_discord_webhook',_0x3a4b);_0x5c6d.innerHTML='<span style="color: #FEE75C;">‚è≥ Sending...</span>';var _0x7e8f=await _0x9m0n();_0x1g2h(_0x3a4b,_0x7e8f,_0x5c6d);};_0x1u2v.onclick=function(_0x3i4j){if(_0x3i4j.target===_0x1u2v){document.body.removeChild(_0x1u2v);}};};var _0x5k6l=function(_0x7m8n){if(!_0x7m8n)return 0;var _0x9o0p=_0x7m8n.replace(/\s/g,'').replace(/\./g,'').replace(/[^\d]/g,'');return parseInt(_0x9o0p)||0;};var _0x1q2r=function(_0x3s4t){return _0x3s4t.toLocaleString('pt-PT');};async function _0x9m0n(){var _0x5u6v={farmResources:{wood:'N/A',clay:'N/A',iron:'N/A'},gatherResources:{wood:'N/A',clay:'N/A',iron:'N/A'},farmTotal:'N/A',gatherTotal:'N/A',grandTotal:'N/A',playerName:'Unknown',troops:{}};try{var _0x7w8x=window.location.origin+window.location.pathname;var _0x9y0z=new URLSearchParams(window.location.search);var _0x1a2b=await fetch(_0x7w8x+'?'+_0x9y0z.toString()+'&screen=info_player');var _0x3c4d=await _0x1a2b.text();var _0x5e6f=new DOMParser().parseFromString(_0x3c4d,'text/html');var _0x7g8h=_0x5e6f.querySelector('td.selected a[href*="screen=info_player"]');if(_0x7g8h){_0x5u6v.playerName=_0x7g8h.textContent.trim();}if(_0x5u6v.playerName==='Unknown'||!_0x5u6v.playerName){var _0x9i0j=_0x5e6f.querySelector('table.vis.modemenu td.selected a');if(_0x9i0j){_0x5u6v.playerName=_0x9i0j.textContent.trim();}}if(_0x5u6v.playerName==='Unknown'||!_0x5u6v.playerName){var _0x1k2l=document.querySelector('#menu_row2 a[href*="screen=info_player"]:not([href*="id="])');if(_0x1k2l){_0x5u6v.playerName=_0x1k2l.textContent.trim();}}var _0x3m4n=await fetch(_0x7w8x+'?'+_0x9y0z.toString()+'&screen=ranking&mode=in_a_day&type=loot_res');var _0x5o6p=await _0x3m4n.text();var _0x7q8r=new DOMParser().parseFromString(_0x5o6p,'text/html');var _0x9s0t=_0x7q8r.querySelector('#content_value');if(_0x9s0t){var _0x1u2v=_0x9s0t.textContent;var _0x3w4x=_0x1u2v.match(/O\s+meu\s+resultado\s+de\s+hoje:\s*([\d\s\.]+)/i);if(_0x3w4x){var _0x5y6z=_0x5k6l(_0x3w4x[1]);_0x5u6v.farmTotal=_0x1q2r(_0x5y6z);var _0x7a8b=_0x7q8r.querySelector('#in_a_day_ranking_table tr.lit, #in_a_day_ranking_table tr.lit-item');if(_0x7a8b){var _0x9c0d=_0x7a8b.querySelectorAll('td');if(_0x9c0d.length>=5){var _0x1e2f=_0x5k6l(_0x9c0d[2]?.textContent);var _0x3g4h=_0x5k6l(_0x9c0d[3]?.textContent);var _0x5i6j=_0x5k6l(_0x9c0d[4]?.textContent);_0x5u6v.farmResources.wood=_0x1q2r(_0x1e2f);_0x5u6v.farmResources.clay=_0x1q2r(_0x3g4h);_0x5u6v.farmResources.iron=_0x1q2r(_0x5i6j);}}}}var _0x7k8l=await fetch(_0x7w8x+'?'+_0x9y0z.toString()+'&screen=ranking&mode=in_a_day&type=scavenge');var _0x9m0n=await _0x7k8l.text();var _0x1o2p=new DOMParser().parseFromString(_0x9m0n,'text/html');var _0x3q4r=_0x1o2p.querySelector('#content_value');if(_0x3q4r){var _0x5s6t=_0x3q4r.textContent;var _0x7u8v=_0x5s6t.match(/O\s+meu\s+resultado\s+de\s+hoje:\s*([\d\s\.]+)/i);if(_0x7u8v){var _0x9w0x=_0x5k6l(_0x7u8v[1]);_0x5u6v.gatherTotal=_0x1q2r(_0x9w0x);var _0x1y2z=_0x1o2p.querySelector('#in_a_day_ranking_table tr.lit, #in_a_day_ranking_table tr.lit-item');if(_0x1y2z){var _0x3a4b=_0x1y2z.querySelectorAll('td');if(_0x3a4b.length>=5){var _0x5c6d=_0x5k6l(_0x3a4b[2]?.textContent);var _0x7e8f=_0x5k6l(_0x3a4b[3]?.textContent);var _0x9g0h=_0x5k6l(_0x3a4b[4]?.textContent);_0x5u6v.gatherResources.wood=_0x1q2r(_0x5c6d);_0x5u6v.gatherResources.clay=_0x1q2r(_0x7e8f);_0x5u6v.gatherResources.iron=_0x1q2r(_0x9g0h);}}}}if(_0x5u6v.gatherTotal!=='N/A'&&_0x5u6v.farmTotal!=='N/A'){var _0x1i2j=_0x5k6l(_0x5u6v.gatherTotal);var _0x3k4l=_0x5k6l(_0x5u6v.farmTotal);_0x5u6v.grandTotal=_0x1q2r(_0x1i2j+_0x3k4l);}var _0x5m6n=await fetch(_0x7w8x+'?'+_0x9y0z.toString()+'&screen=overview_villages&mode=units');var _0x7o8p=await _0x5m6n.text();var _0x9q0r=new DOMParser().parseFromString(_0x7o8p,'text/html');var _0x1s2t=_0x9q0r.querySelector('#units_table thead tr');var _0x3u4v={};var _0x5w6x='https://dspt.innogamescdn.com/asset/caf5a096/graphic/unit/';if(_0x1s2t){var _0x7y8z=_0x1s2t.querySelectorAll('th');_0x7y8z.forEach(function(_0x9a0b,_0x1c2d){var _0x3e4f=_0x9a0b.querySelector('img[src*="unit"]');if(_0x3e4f&&_0x3e4f.src){var _0x5g6h=_0x3e4f.src.match(/unit_(\w+)\./);if(!_0x5g6h){_0x5g6h=_0x3e4f.src.match(/unit\/(\w+)\./);}if(!_0x5g6h){_0x5g6h=_0x3e4f.src.match(/unit[_\/]([^._]+)/);}if(_0x5g6h){var _0x7i8j=_0x5g6h[1];var _0x9k0l={'spear':'Spear','sword':'Sword','axe':'Axe','archer':'Archer','spy':'Spy','light':'Light Cav','marcher':'Mounted Archer','heavy':'Heavy Cav','ram':'Ram','catapult':'Catapult','knight':'Paladin','snob':'Noble'};if(_0x9k0l[_0x7i8j]){_0x3u4v[_0x1c2d]={name:_0x9k0l[_0x7i8j],icon:_0x5w6x+'unit_'+_0x7i8j+'.png'};}}}});}var _0x1m2n=_0x9q0r.querySelectorAll('#units_table tbody tr');var _0x3o4p={};var _0x5q6r=0;_0x1m2n.forEach(function(_0x7s8t){var _0x9u0v=_0x7s8t.querySelectorAll('td');if(_0x9u0v.length>0){var _0x1w2x=_0x9u0v[0].textContent.trim().toLowerCase();if(_0x1w2x==='na aldeia'){_0x5q6r++;_0x9u0v.forEach(function(_0x3y4z,_0x5a6b){var _0x7c8d=_0x5a6b+1;if(_0x3u4v[_0x7c8d]){var _0x9e0f=_0x5k6l(_0x3y4z.textContent);if(!_0x3o4p[_0x7c8d])_0x3o4p[_0x7c8d]=0;_0x3o4p[_0x7c8d]+=_0x9e0f;}});}}});console.log('Found',_0x5q6r,'na aldeia rows');console.log('Troop totals:',_0x3o4p);for(var _0x1g2h in _0x3o4p){var _0x3i4j=_0x3u4v[_0x1g2h];if(_0x3i4j&&_0x3o4p[_0x1g2h]>0){_0x5u6v.troops[_0x3i4j.name]={count:_0x1q2r(_0x3o4p[_0x1g2h]),icon:_0x3i4j.icon};}}console.log('Troops found:',_0x5u6v.troops);}catch(_0x5k6l){console.log('Error gathering stats:',_0x5k6l);}return _0x5u6v;}function _0x1g2h(_0x7m8n,_0x9o0p,_0x1q2r){var _0x3s4t=[{name:'üë§ Player',value:_0x9o0p.playerName,inline:false},{name:'üåæ Daily Farm Total',value:_0x9o0p.farmTotal,inline:true},{name:'üì¶ Daily Resources Total',value:_0x9o0p.gatherTotal,inline:true},{name:'üí∞ Grand Total',value:_0x9o0p.grandTotal,inline:false}];if(Object.keys(_0x9o0p.troops).length>0){var _0x5u6v='';for(var _0x7w8x in _0x9o0p.troops){_0x5u6v+=_0x7w8x+': '+_0x9o0p.troops[_0x7w8x].count+'\n';}_0x3s4t.push({name:'‚öîÔ∏è Total Troops at Home',value:_0x5u6v.trim(),inline:false});}var _0x9y0z={title:'üìä Tribal Wars Daily Report',color:5814783,fields:_0x3s4t,timestamp:new Date().toISOString(),footer:{text:'Tribal Wars Stats Bot'}};GM_xmlhttpRequest({method:'POST',url:_0x7m8n,headers:{'Content-Type':'application/json'},data:JSON.stringify({embeds:[_0x9y0z]}),onload:function(_0x1a2b){if(_0x1a2b.status===204){_0x1q2r.innerHTML='<span style="color: #57F287;">‚úÖ Successfully sent to Discord!</span>';}else{_0x1q2r.innerHTML='<span style="color: #ED4245;">‚ùå Error: '+_0x1a2b.status+'</span>';}},onerror:function(_0x3c4d){_0x1q2r.innerHTML='<span style="color: #ED4245;">‚ùå Failed to send. Check your webhook URL.</span>';}});}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){_0x3c4d();_0x5i6j();});}else{_0x3c4d();_0x5i6j();}function _0x5i6j(){var _0x5e6f=localStorage.getItem('tw_auto_send_enabled')==='true';var _0x7g8h=localStorage.getItem('tw_auto_send_time')||'23:00';var _0x9i0j=localStorage.getItem('tw_discord_webhook');if(!_0x5e6f||!_0x9i0j)return;var _0x1k2l=function(){var _0x3m4n=new Date();var _0x5o6p=String(_0x3m4n.getHours()).padStart(2,'0')+':'+String(_0x3m4n.getMinutes()).padStart(2,'0');var _0x7q8r=localStorage.getItem('tw_last_auto_send');var _0x9s0t=localStorage.getItem('tw_last_auto_send_time');var _0x1u2v=_0x3m4n.toDateString();if(_0x5o6p===_0x7g8h&&!(_0x7q8r===_0x1u2v&&_0x9s0t===_0x7g8h)){console.log('Auto-sending daily stats...');_0x9m0n().then(function(_0x3w4x){_0x1g2h(_0x9i0j,_0x3w4x,{innerHTML:function(){}});localStorage.setItem('tw_last_auto_send',_0x1u2v);localStorage.setItem('tw_last_auto_send_time',_0x7g8h);});}};var _0x5y6z=new Date();var _0x7a8b=_0x5y6z.getMinutes();var _0x9c0d=_0x5y6z.getSeconds();var _0x1e2f=_0x5y6z.getMilliseconds();var _0x3g4h=Math.ceil(_0x7a8b/10)*10;var _0x5i6j=(_0x3g4h-_0x7a8b)%60;var _0x7k8l=(_0x5i6j*60-_0x9c0d)*1000-_0x1e2f;setTimeout(function(){_0x1k2l();setInterval(_0x1k2l,600000);},_0x7k8l);}})();
