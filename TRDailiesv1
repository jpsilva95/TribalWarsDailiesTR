(function(){var _0x1a2b='use strict';var _0x3c4d=function(){var _0x5e6f=document.querySelector('.questlog, #questlog_new, [id*="questlog"]');if(_0x5e6f){var _0x7g8h=document.createElement('div');_0x7g8h.style.cssText='margin-top: 5px; text-align: center;';var _0x9i0j=document.createElement('button');_0x9i0j.innerHTML='<img src="https://i.ibb.co/RptK4TP5/teamrocketlogo.gif" style="width: 30px; height: 30px;">';_0x9i0j.title='Daily Stats to Discord';_0x9i0j.style.cssText='width: 40px; height: 40px; background: transparent; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; padding: 0;';_0x9i0j.onclick=function(_0x1k2l){_0x1k2l.preventDefault();_0x3m4n();};_0x7g8h.appendChild(_0x9i0j);_0x5e6f.appendChild(_0x7g8h);}else{var _0x5o6p=document.querySelector('#header_info');if(_0x5o6p){var _0x7q8r=document.createElement('a');_0x7q8r.href='#';_0x7q8r.innerHTML='<img src="https://i.ibb.co/RptK4TP5/teamrocketlogo.gif" style="width: 20px; height: 20px; vertical-align: middle;">';_0x7q8r.title='Daily Stats';_0x7q8r.style.cssText='margin-left: 10px; padding: 5px; background: transparent; border: none; text-decoration: none; display: inline-block;';_0x7q8r.onclick=function(_0x9s0t){_0x9s0t.preventDefault();_0x3m4n();};_0x5o6p.appendChild(_0x7q8r);}}};var _0x3m4n=function(){var _0x1u2v=document.createElement('div');_0x1u2v.style.cssText='position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;';var _0x3w4x=document.createElement('div');_0x3w4x.style.cssText='background: #2C2F33; color: #DCDDDE; padding: 25px; border-radius: 8px; width: 550px; box-shadow: 0 8px 16px rgba(0,0,0,0.3);';_0x3w4x.innerHTML='<h2 style="margin-top: 0; color: #5865F2;">üìä Send Daily Stats to Discord</h2><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px; font-weight: bold;">Discord Webhook URL:</label><input type="text" id="webhookUrl" placeholder="https://discord.com/api/webhooks/..." style="width: 100%; padding: 8px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box;"></div><div style="margin-bottom: 15px;"><label style="display: block; margin-bottom: 5px;"><input type="checkbox" id="autoSendEnabled" style="margin-right: 5px;"><strong>Auto-send daily at:</strong></label><input type="time" id="autoSendTime" value="23:00" disabled style="width: 100%; padding: 8px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box;"><p style="font-size: 12px; color: #B9BBBE; margin: 5px 0 0 0;">Leave the game open for auto-send to work</p></div><div id="statsPreview" style="background: #40444B; padding: 15px; border-radius: 4px; margin-bottom: 15px;"><p style="margin: 5px 0;"><strong>Gathering stats...</strong></p></div><div style="display: flex; gap: 10px;"><button id="sendBtn" style="flex: 1; padding: 10px; background: #5865F2; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">Send to Discord</button><button id="closeBtn" style="flex: 1; padding: 10px; background: #ED4245; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold;">Close</button></div><div id="statusMsg" style="margin-top: 15px; text-align: center; font-size: 14px;"></div>';_0x1u2v.appendChild(_0x3w4x);document.body.appendChild(_0x1u2v);var _0x5y6z=localStorage.getItem('tw_discord_webhook');var _0x7a8b=localStorage.getItem('tw_auto_send_enabled')==='true';var _0x9c0d=localStorage.getItem('tw_auto_send_time')||'23:00';if(_0x5y6z){document.getElementById('webhookUrl').value=_0x5y6z;}var _0x1e2f=document.getElementById('autoSendEnabled');var _0x3g4h=document.getElementById('autoSendTime');_0x1e2f.checked=_0x7a8b;_0x3g4h.value=_0x9c0d;_0x3g4h.disabled=!_0x7a8b;_0x1e2f.onchange=function(){_0x3g4h.disabled=!_0x1e2f.checked;localStorage.setItem('tw_auto_send_enabled',_0x1e2f.checked);if(_0x1e2f.checked){localStorage.setItem('tw_auto_send_time',_0x3g4h.value);_0x5i6j();}};_0x3g4h.onchange=function(){localStorage.setItem('tw_auto_send_time',_0x3g4h.value);if(_0x1e2f.checked){_0x5i6j();}};var _0x7k8l=document.getElementById('statsPreview');_0x7k8l.innerHTML='<p style="margin: 5px 0;"><strong>Loading stats...</strong></p>';_0x9m0n().then(function(_0x1o2p){var _0x3q4r='';if(Object.keys(_0x1o2p.troops).length>0){_0x3q4r='<p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>‚öîÔ∏è Total Troops at Home:</strong></p>';for(var _0x5s6t in _0x1o2p.troops){var _0x7u8v=_0x1o2p.troops[_0x5s6t];var _0x9w0x=_0x7u8v.icon?'<img src="'+_0x7u8v.icon+'" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 4px;">':'';_0x3q4r+='<p style="margin: 2px 0; padding-left: 20px; font-size: 13px;">'+_0x9w0x+_0x5s6t+': '+_0x7u8v.count+'</p>';}}if(_0x1o2p.playerName&&_0x1o2p.playerName!=='Unknown'){var _0x1y2z=document.getElementById('webhookUrl').value.trim();if(_0x1y2z){var _0x3a4b=_0x1y2z.split('/').pop();var _0x5c6d='tw_player_name_'+_0x1o2p.world+'_'+_0x3a4b;localStorage.setItem(_0x5c6d,_0x1o2p.playerName);}}var _0x7e8f='';if(_0x1o2p.playerName==='Unknown'){_0x7e8f='<div style="margin: 10px 0; padding: 10px; background: #ED4245; border-radius: 4px;"><p style="margin: 0 0 5px 0; font-size: 12px; color: white;"><strong>‚ö†Ô∏è Player name not detected</strong></p><input type="text" id="manualPlayerName" placeholder="Enter your player name" style="width: 100%; padding: 6px; border: 1px solid #40444B; background: #40444B; color: #DCDDDE; border-radius: 4px; box-sizing: border-box; font-size: 13px;"></div>';}_0x7k8l.innerHTML='<p style="margin: 5px 0;"><strong>üåç World:</strong> '+_0x1o2p.world+'</p><p style="margin: 5px 0;"><strong>üë§ Player:</strong> '+_0x1o2p.playerName+'</p>'+_0x7e8f+'<p style="margin: 5px 0;"><strong>üåæ Daily Farm Total:</strong> '+_0x1o2p.farmTotal+'</p><p style="margin: 5px 0;"><strong>üì¶ Daily Resources Total:</strong> '+_0x1o2p.gatherTotal+'</p><p style="margin: 10px 0 5px 0; border-top: 1px solid #2C2F33; padding-top: 10px;"><strong>üí∞ Grand Total:</strong> '+_0x1o2p.grandTotal+'</p>'+_0x3q4r;}).catch(function(_0x9g0h){_0x7k8l.innerHTML='<p style="margin: 5px 0; color: #ED4245;"><strong>Error loading stats. Please try again.</strong></p>';console.error('Error gathering stats:',_0x9g0h);});document.getElementById('closeBtn').onclick=function(){document.body.removeChild(_0x1u2v);};document.getElementById('sendBtn').onclick=async function(){var _0x1i2j=document.getElementById('webhookUrl').value.trim();var _0x3k4l=document.getElementById('statusMsg');if(!_0x1i2j){_0x3k4l.innerHTML='<span style="color: #ED4245;">‚ùå Please enter a webhook URL</span>';return;}localStorage.setItem('tw_discord_webhook',_0x1i2j);_0x3k4l.innerHTML='<span style="color: #FEE75C;">‚è≥ Sending...</span>';var _0x5m6n=await _0x9m0n();var _0x7o8p=document.getElementById('manualPlayerName');if(_0x7o8p&&_0x7o8p.value.trim()){_0x5m6n.playerName=_0x7o8p.value.trim();var _0x9q0r=_0x1i2j.split('/').pop();var _0x1s2t='tw_player_name_'+_0x5m6n.world+'_'+_0x9q0r;localStorage.setItem(_0x1s2t,_0x5m6n.playerName);}_0x3u4v(_0x1i2j,_0x5m6n,_0x3k4l);};_0x1u2v.onclick=function(_0x5w6x){if(_0x5w6x.target===_0x1u2v){document.body.removeChild(_0x1u2v);}};};var _0x7y8z=function(_0x9a0b){if(!_0x9a0b)return 0;var _0x1c2d=_0x9a0b.replace(/\s/g,'').replace(/\./g,'').replace(/[^\d]/g,'');return parseInt(_0x1c2d)||0;};var _0x3e4f=function(_0x5g6h){return _0x5g6h.toLocaleString('pt-PT');};async function _0x9m0n(){var _0x7i8j={farmResources:{wood:'N/A',clay:'N/A',iron:'N/A'},gatherResources:{wood:'N/A',clay:'N/A',iron:'N/A'},farmTotal:'N/A',gatherTotal:'N/A',grandTotal:'N/A',playerName:'Unknown',troops:{},world:'Unknown'};try{var _0x9k0l=window.location.origin+window.location.pathname;var _0x1m2n=new URLSearchParams(window.location.search);var _0x3o4p=window.location.hostname.match(/^(\w+)\./);_0x7i8j.world=_0x3o4p?_0x3o4p[1].toUpperCase():'Unknown';var _0x5q6r=await fetch(_0x9k0l+'?'+_0x1m2n.toString()+'&screen=info_player');var _0x7s8t=await _0x5q6r.text();var _0x9u0v=new DOMParser().parseFromString(_0x7s8t,'text/html');var _0x1w2x=_0x9u0v.querySelector('td.selected a[href*="screen=info_player"]');if(_0x1w2x){_0x7i8j.playerName=_0x1w2x.textContent.trim();}if(_0x7i8j.playerName==='Unknown'||!_0x7i8j.playerName){var _0x3y4z=_0x9u0v.querySelector('table.vis.modemenu td.selected a');if(_0x3y4z){_0x7i8j.playerName=_0x3y4z.textContent.trim();}}if(_0x7i8j.playerName==='Unknown'||!_0x7i8j.playerName){var _0x5a6b=document.querySelector('#menu_row2 a[href*="screen=info_player"]:not([href*="id="])');if(_0x5a6b){_0x7i8j.playerName=_0x5a6b.textContent.trim();}}if(_0x7i8j.playerName==='Unknown'||!_0x7i8j.playerName){var _0x7c8d=document.querySelector('#menu_row2');if(_0x7c8d){var _0x9e0f=_0x7c8d.querySelectorAll('a[href*="screen=info_player"]:not([href*="id="])');if(_0x9e0f.length>0){_0x7i8j.playerName=_0x9e0f[0].textContent.trim();}}}var _0x1g2h=await fetch(_0x9k0l+'?'+_0x1m2n.toString()+'&screen=ranking&mode=in_a_day&type=loot_res');var _0x3i4j=await _0x1g2h.text();var _0x5k6l=new DOMParser().parseFromString(_0x3i4j,'text/html');var _0x7m8n=_0x5k6l.querySelector('#content_value');if(_0x7m8n){var _0x9o0p=_0x7m8n.textContent;var _0x1q2r=_0x9o0p.match(/O\s+meu\s+resultado\s+de\s+hoje:\s*([\d\s\.]+)/i);if(_0x1q2r){var _0x3s4t=_0x7y8z(_0x1q2r[1]);_0x7i8j.farmTotal=_0x3e4f(_0x3s4t);var _0x5u6v=_0x5k6l.querySelector('#in_a_day_ranking_table tr.lit, #in_a_day_ranking_table tr.lit-item');if(_0x5u6v){var _0x7w8x=_0x5u6v.querySelectorAll('td');if(_0x7w8x.length>=5){var _0x9y0z=_0x7y8z(_0x7w8x[2]?.textContent);var _0x1a2b=_0x7y8z(_0x7w8x[3]?.textContent);var _0x3c4d=_0x7y8z(_0x7w8x[4]?.textContent);_0x7i8j.farmResources.wood=_0x3e4f(_0x9y0z);_0x7i8j.farmResources.clay=_0x3e4f(_0x1a2b);_0x7i8j.farmResources.iron=_0x3e4f(_0x3c4d);}}}}var _0x5e6f=await fetch(_0x9k0l+'?'+_0x1m2n.toString()+'&screen=ranking&mode=in_a_day&type=scavenge');var _0x7g8h=await _0x5e6f.text();var _0x9i0j=new DOMParser().parseFromString(_0x7g8h,'text/html');var _0x1k2l=_0x9i0j.querySelector('#content_value');if(_0x1k2l){var _0x3m4n=_0x1k2l.textContent;var _0x5o6p=_0x3m4n.match(/O\s+meu\s+resultado\s+de\s+hoje:\s*([\d\s\.]+)/i);if(_0x5o6p){var _0x7q8r=_0x7y8z(_0x5o6p[1]);_0x7i8j.gatherTotal=_0x3e4f(_0x7q8r);var _0x9s0t=_0x9i0j.querySelector('#in_a_day_ranking_table tr.lit, #in_a_day_ranking_table tr.lit-item');if(_0x9s0t){var _0x1u2v=_0x9s0t.querySelectorAll('td');if(_0x1u2v.length>=5){var _0x3w4x=_0x7y8z(_0x1u2v[2]?.textContent);var _0x5y6z=_0x7y8z(_0x1u2v[3]?.textContent);var _0x7a8b=_0x7y8z(_0x1u2v[4]?.textContent);_0x7i8j.gatherResources.wood=_0x3e4f(_0x3w4x);_0x7i8j.gatherResources.clay=_0x3e4f(_0x5y6z);_0x7i8j.gatherResources.iron=_0x3e4f(_0x7a8b);}}}}if(_0x7i8j.gatherTotal!=='N/A'&&_0x7i8j.farmTotal!=='N/A'){var _0x9c0d=_0x7y8z(_0x7i8j.gatherTotal);var _0x1e2f=_0x7y8z(_0x7i8j.farmTotal);_0x7i8j.grandTotal=_0x3e4f(_0x9c0d+_0x1e2f);}var _0x3g4h=await fetch(_0x9k0l+'?'+_0x1m2n.toString()+'&screen=overview_villages&mode=units');var _0x5i6j=await _0x3g4h.text();var _0x7k8l=new DOMParser().parseFromString(_0x5i6j,'text/html');var _0x9m0n=_0x7k8l.querySelector('#units_table thead tr');var _0x1o2p={};var _0x3q4r='https://dspt.innogamescdn.com/asset/caf5a096/graphic/unit/';if(_0x9m0n){var _0x5s6t=_0x9m0n.querySelectorAll('th');_0x5s6t.forEach(function(_0x7u8v,_0x9w0x){var _0x1y2z=_0x7u8v.querySelector('img[src*="unit"]');if(_0x1y2z&&_0x1y2z.src){var _0x3a4b=_0x1y2z.src.match(/unit_(\w+)\./);if(!_0x3a4b){_0x3a4b=_0x1y2z.src.match(/unit\/(\w+)\./);}if(!_0x3a4b){_0x3a4b=_0x1y2z.src.match(/unit[_\/]([^._]+)/);}if(_0x3a4b){var _0x5c6d=_0x3a4b[1];var _0x7e8f={'spear':'Spear','sword':'Sword','axe':'Axe','archer':'Archer','spy':'Spy','light':'Light Cav','marcher':'Mounted Archer','heavy':'Heavy Cav','ram':'Ram','catapult':'Catapult','knight':'Paladin','snob':'Noble'};if(_0x7e8f[_0x5c6d]){_0x1o2p[_0x9w0x]={name:_0x7e8f[_0x5c6d],icon:_0x3q4r+'unit_'+_0x5c6d+'.png'};}}}});}var _0x9g0h=_0x7k8l.querySelectorAll('#units_table tbody tr');var _0x1i2j={};var _0x3k4l=0;_0x9g0h.forEach(function(_0x5m6n){var _0x7o8p=_0x5m6n.querySelectorAll('td');if(_0x7o8p.length>0){var _0x9q0r=_0x7o8p[0].textContent.trim().toLowerCase();if(_0x9q0r==='na aldeia'){_0x3k4l++;_0x7o8p.forEach(function(_0x1s2t,_0x3u4v){var _0x5w6x=_0x3u4v+1;if(_0x1o2p[_0x5w6x]){var _0x7y8z=_0x7y8z(_0x1s2t.textContent);if(!_0x1i2j[_0x5w6x])_0x1i2j[_0x5w6x]=0;_0x1i2j[_0x5w6x]+=_0x7y8z;}});}}});for(var _0x9a0b in _0x1i2j){var _0x1c2d=_0x1o2p[_0x9a0b];if(_0x1c2d&&_0x1i2j[_0x9a0b]>0){_0x7i8j.troops[_0x1c2d.name]={count:_0x3e4f(_0x1i2j[_0x9a0b]),icon:_0x1c2d.icon};}}console.log('Troops found:',_0x7i8j.troops);}catch(_0x3e4f){console.log('Error gathering stats:',_0x3e4f);}return _0x7i8j;}function _0x3u4v(_0x5g6h,_0x7i8j,_0x9k0l){var _0x1m2n=[{name:'üë§ Player',value:_0x7i8j.playerName,inline:false},{name:'üåç World',value:_0x7i8j.world,inline:false},{name:'üåæ Daily Farm Total',value:_0x7i8j.farmTotal,inline:true},{name:'üì¶ Daily Resources Total',value:_0x7i8j.gatherTotal,inline:true},{name:'üí∞ Grand Total',value:_0x7i8j.grandTotal,inline:false}];if(Object.keys(_0x7i8j.troops).length>0){var _0x3o4p='';for(var _0x5q6r in _0x7i8j.troops){_0x3o4p+=_0x5q6r+': '+_0x7i8j.troops[_0x5q6r].count+'\n';}_0x1m2n.push({name:'‚öîÔ∏è Total Troops at Home',value:_0x3o4p.trim(),inline:false});}var _0x7s8t={title:'üìä Tribal Wars Daily Report',color:5814783,fields:_0x1m2n,timestamp:new Date().toISOString(),footer:{text:'Tribal Wars Stats Bot'}};GM_xmlhttpRequest({method:'POST',url:_0x5g6h,headers:{'Content-Type':'application/json'},data:JSON.stringify({embeds:[_0x7s8t]}),onload:function(_0x9u0v){if(_0x9u0v.status===204){_0x9k0l.innerHTML='<span style="color: #57F287;">‚úÖ Successfully sent to Discord!</span>';}else{_0x9k0l.innerHTML='<span style="color: #ED4245;">‚ùå Error: '+_0x9u0v.status+'</span>';}},onerror:function(_0x1w2x){_0x9k0l.innerHTML='<span style="color: #ED4245;">‚ùå Failed to send. Check your webhook URL.</span>';}});}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',function(){_0x3c4d();_0x5i6j();});}else{_0x3c4d();_0x5i6j();}function _0x5i6j(){var _0x3y4z=localStorage.getItem('tw_auto_send_enabled')==='true';var _0x5a6b=localStorage.getItem('tw_auto_send_time')||'23:00';var _0x7c8d=localStorage.getItem('tw_discord_webhook');if(!_0x3y4z||!_0x7c8d)return;var _0x9e0f=function(){var _0x1g2h=new Date();var _0x3i4j=String(_0x1g2h.getHours()).padStart(2,'0')+':'+String(_0x1g2h.getMinutes()).padStart(2,'0');var _0x5k6l=localStorage.getItem('tw_last_auto_send');var _0x7m8n=localStorage.getItem('tw_last_auto_send_time');var _0x9o0p=_0x1g2h.toDateString();if(_0x3i4j===_0x5a6b&&!(_0x5k6l===_0x9o0p&&_0x7m8n===_0x5a6b)){var _0x1q2r='tw_auto_send_lock';var _0x3s4t=localStorage.getItem(_0x1q2r);var _0x5u6v=_0x3s4t?parseInt(_0x3s4t):0;if(Date.now()<_0x5u6v){return;}localStorage.setItem(_0x1q2r,(Date.now()+30000).toString());_0x9m0n().then(function(_0x7w8x){if(_0x7w8x.playerName==='Unknown'||!_0x7w8x.playerName){var _0x9y0z=_0x7c8d.split('/').pop();var _0x1a2b='tw_player_name_'+_0x7w8x.world+'_'+_0x9y0z;var _0x3c4d=localStorage.getItem(_0x1a2b);if(_0x3c4d){_0x7w8x.playerName=_0x3c4d;}}_0x3u4v(_0x7c8d,_0x7w8x,{innerHTML:function(){}});localStorage.setItem('tw_last_auto_send',_0x9o0p);localStorage.setItem('tw_last_auto_send_time',_0x5a6b);localStorage.removeItem(_0x1q2r);});}};var _0x5e6f=new Date();var _0x7g8h=_0x5e6f.getMinutes();var _0x9i0j=_0x5e6f.getSeconds();var _0x1k2l=_0x5e6f.getMilliseconds();var _0x3m4n=Math.ceil(_0x7g8h/10)*10;var _0x5o6p=(_0x3m4n-_0x7g8h)%60;var _0x7q8r=(_0x5o6p*60-_0x9i0j)*1000-_0x1k2l;setTimeout(function(){_0x9e0f();setInterval(_0x9e0f,600000);},_0x7q8r);}})();
